(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[437],{6162:function(e,t,a){Promise.resolve().then(a.bind(a,8434))},8434:function(e,t,a){"use strict";a.d(t,{default:function(){return f}});var n=a(7437),i=a(2265),s=a(29),l=a.n(s),o=a(2520),r=a.n(o);a(4982);var c=a(257);function p(e){let{spots:t,routes:a,showRoutes:s,filterAvailable:o,onSpotClick:p,selectedSpot:d,currentLocation:g}=e,u=(0,i.useRef)(null),m=(0,i.useRef)(null),h=(0,i.useRef)([]),[y,f]=(0,i.useState)(!1),w=c.env.NEXT_PUBLIC_MAPBOX_TOKEN||"pk.eyJ1Ijoia2VudGEtdGFuYWthIiwiYSI6ImNsb2R0Z2Z0ZzAwMWYzZHF0dGJ6dGJ6dGJ6In0.example";console.log("Mapbox token loaded:",w?"YES":"NO"),console.log("Token preview:",w.substring(0,20)+"...");let b=o?t.filter(e=>e.availableBikes>0):t,v=(0,i.useCallback)(e=>{p(e)},[p]);return(0,i.useEffect)(()=>{if(!m.current)return r().accessToken=w,u.current&&(m.current=new(r()).Map({container:u.current,style:"mapbox://styles/mapbox/streets-v12",center:[139.4494885,35.393351],zoom:14,pitch:0,bearing:0,projection:"mercator"}),m.current.on("load",()=>{f(!0),console.log("Map loaded, ready for Hello Cycling markers...")}),m.current.addControl(new(r()).NavigationControl,"top-right")),()=>{m.current&&(m.current.getSource("cycling-spots")&&(m.current.removeLayer("cycling-spots"),m.current.removeSource("cycling-spots")),m.current.remove(),m.current=null)}},[]),(0,i.useEffect)(()=>{if(!m.current||!y)return;let e={type:"FeatureCollection",features:b.map(e=>({type:"Feature",geometry:{type:"Point",coordinates:[e.longitude,e.latitude]},properties:{id:e.id,name:e.name,availableBikes:e.availableBikes,isRenting:e.isRenting,isReturning:e.isReturning,urgencyLevel:e.urgencyLevel,trend:e.trend,isSelected:(null==d?void 0:d.id)===e.id}}))};m.current.getSource("cycling-spots")&&(m.current.removeLayer("cycling-spots"),m.current.removeSource("cycling-spots")),m.current.addSource("cycling-spots",{type:"geojson",data:e}),m.current.addLayer({id:"cycling-spots",type:"circle",source:"cycling-spots",paint:{"circle-radius":["case",["get","isSelected"],12,8],"circle-color":["case",["==",["get","urgencyLevel"],"critical"],"#E91E63",["==",["get","urgencyLevel"],"high"],"#FF5722",["==",["get","urgencyLevel"],"medium"],"#FF9800","#4CAF50"],"circle-stroke-width":["case",["get","isSelected"],3,1],"circle-stroke-color":"#ffffff"}}),m.current.on("click","cycling-spots",e=>{var t;let a=null===(t=e.features)||void 0===t?void 0:t[0];if(a&&a.properties){let t=b.find(e=>e.id===a.properties.id);t&&(new(r()).Popup({maxWidth:"300px",className:"cycling-popup"}).setLngLat(e.lngLat).setHTML('\n              <div class="cycling-popup-content">\n                <div class="cycling-popup-header">\n                  <h3 class="cycling-popup-title">'.concat(t.name,'</h3>\n                  <span class="cycling-popup-urgency urgency-').concat(t.urgencyLevel,'">\n                    ').concat("critical"===t.urgencyLevel?"緊急":"high"===t.urgencyLevel?"要注意":"medium"===t.urgencyLevel?"注意":"余裕あり",'\n                  </span>\n                </div>\n                <div class="cycling-popup-body">\n                  <div class="cycling-popup-info">\n                    <div class="cycling-popup-item">\n                      <span class="cycling-popup-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                          <circle cx="12" cy="12" r="10"></circle>\n                          <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>\n                          <line x1="9" y1="9" x2="9.01" y2="9"></line>\n                          <line x1="15" y1="9" x2="15.01" y2="9"></line>\n                        </svg>\n                        利用可能\n                      </span>\n                      <span class="cycling-popup-value ').concat(t.availableBikes>1?"available":1===t.availableBikes?"low-availability":"unavailable",'">\n                        ').concat(t.availableBikes,'台\n                      </span>\n                    </div>\n                    <div class="cycling-popup-item">\n                      <span class="cycling-popup-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>\n                          <circle cx="12" cy="10" r="3"></circle>\n                        </svg>\n                        返却可能台数\n                      </span>\n                      <span class="cycling-popup-value">\n                        ').concat(t.totalBikes-t.availableBikes,"台\n                      </span>\n                    </div>\n                    ").concat(t.rapidChange?'\n                    <div class="cycling-popup-item cycling-popup-alert">\n                      <span class="cycling-popup-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>\n                          <line x1="12" y1="9" x2="12" y2="13"></line>\n                          <line x1="12" y1="17" x2="12.01" y2="17"></line>\n                        </svg>\n                        急激な変化\n                      </span>\n                      <span class="cycling-popup-value demand-surge-'.concat(t.demandSurge,'">\n                        ').concat("extreme"===t.demandSurge?"極めて高い需要":"high"===t.demandSurge?"高い需要":"medium"===t.demandSurge?"やや高い需要":"通常","\n                      </span>\n                    </div>\n                    "):"","\n                    ").concat(t.timeToEmpty&&t.timeToEmpty<30?'\n                    <div class="cycling-popup-item cycling-popup-warning">\n                      <span class="cycling-popup-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                          <circle cx="12" cy="12" r="10"></circle>\n                          <polyline points="12,6 12,12 16,14"></polyline>\n                        </svg>\n                        予測時間\n                      </span>\n                      <span class="cycling-popup-value time-warning">\n                        約'.concat(Math.round(t.timeToEmpty),"分で満車予想\n                      </span>\n                    </div>\n                    "):"","\n                  </div>\n                </div>\n              </div>\n            ")).addTo(m.current),v(t))}}),m.current.on("mouseenter","cycling-spots",()=>{m.current.getCanvas().style.cursor="pointer"}),m.current.on("mouseleave","cycling-spots",()=>{m.current.getCanvas().style.cursor=""})},[b,y,d,v]),(0,i.useEffect)(()=>{if(!m.current||!y||!g)return;let e=document.querySelector(".cycling-current-location-marker");e&&e.remove();let t=document.createElement("div");t.className="cycling-current-location-marker",t.innerHTML='\n      <div class="cycling-current-location-pulse"></div>\n      <div class="cycling-current-location-dot">\uD83D\uDCCD</div>\n    ',new(r()).Marker({element:t,anchor:"center"}).setLngLat([g[0],g[1]]).addTo(m.current)},[g,y]),(0,i.useEffect)(()=>{m.current&&y&&(h.current.forEach(e=>{m.current.getSource(e)&&m.current.removeSource(e),m.current.getLayer(e)&&m.current.removeLayer(e)}),h.current=[],s&&a.forEach((e,t)=>{let a="route-".concat(e.id);m.current.addSource(a,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e.coordinates}}}),m.current.addLayer({id:a,type:"line",source:a,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":e.color,"line-width":4,"line-opacity":.8}}),h.current.push(a)}))},[a,s,y]),(0,n.jsxs)("div",{className:"jsx-42827e627c258091 cycling-map-container",children:[(0,n.jsx)("div",{ref:u,className:"jsx-42827e627c258091 cycling-map"}),(0,n.jsx)(l(),{id:"42827e627c258091",children:".cycling-marker.jsx-42827e627c258091{position:relative;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-transition:-webkit-transform.2s ease;-moz-transition:-moz-transform.2s ease;-o-transition:-o-transform.2s ease;transition:-webkit-transform.2s ease;transition:-moz-transform.2s ease;transition:-o-transform.2s ease;transition:transform.2s ease}.cycling-marker.jsx-42827e627c258091:hover{-webkit-transform:scale(1.1);-moz-transform:scale(1.1);-ms-transform:scale(1.1);-o-transform:scale(1.1);transform:scale(1.1)}.cycling-marker.selected.jsx-42827e627c258091{-webkit-transform:scale(1.2);-moz-transform:scale(1.2);-ms-transform:scale(1.2);-o-transform:scale(1.2);transform:scale(1.2);z-index:1000}.cycling-marker-icon.jsx-42827e627c258091{width:40px;height:40px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;font-size:20px;-webkit-box-shadow:0 2px 8px rgba(0,0,0,.15);-moz-box-shadow:0 2px 8px rgba(0,0,0,.15);box-shadow:0 2px 8px rgba(0,0,0,.15);-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.cycling-marker-icon.available.jsx-42827e627c258091{background:#4caf50;color:white}.cycling-marker-icon.unavailable.jsx-42827e627c258091{background:#f44336;color:white}.cycling-marker-count.jsx-42827e627c258091{position:absolute;top:-8px;right:-8px;background:#06c;color:white;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;width:20px;height:20px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;font-size:12px;font-weight:600;border:2px solid white}.cycling-current-location-marker.jsx-42827e627c258091{position:relative;width:20px;height:20px}.cycling-current-location-dot.jsx-42827e627c258091{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%);font-size:20px;z-index:2}.cycling-current-location-pulse.jsx-42827e627c258091{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%);width:20px;height:20px;background:#06c;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:pulse 2s infinite;-moz-animation:pulse 2s infinite;-o-animation:pulse 2s infinite;animation:pulse 2s infinite;z-index:1}@-webkit-keyframes pulse{0%{-webkit-transform:translate(-50%,-50%)scale(.8);transform:translate(-50%,-50%)scale(.8);opacity:1}100%{-webkit-transform:translate(-50%,-50%)scale(2);transform:translate(-50%,-50%)scale(2);opacity:0}}@-moz-keyframes pulse{0%{-moz-transform:translate(-50%,-50%)scale(.8);transform:translate(-50%,-50%)scale(.8);opacity:1}100%{-moz-transform:translate(-50%,-50%)scale(2);transform:translate(-50%,-50%)scale(2);opacity:0}}@-o-keyframes pulse{0%{-o-transform:translate(-50%,-50%)scale(.8);transform:translate(-50%,-50%)scale(.8);opacity:1}100%{-o-transform:translate(-50%,-50%)scale(2);transform:translate(-50%,-50%)scale(2);opacity:0}}@keyframes pulse{0%{-webkit-transform:translate(-50%,-50%)scale(.8);-moz-transform:translate(-50%,-50%)scale(.8);-o-transform:translate(-50%,-50%)scale(.8);transform:translate(-50%,-50%)scale(.8);opacity:1}100%{-webkit-transform:translate(-50%,-50%)scale(2);-moz-transform:translate(-50%,-50%)scale(2);-o-transform:translate(-50%,-50%)scale(2);transform:translate(-50%,-50%)scale(2);opacity:0}}"})]})}class d{async getSpots(){console.log("=== getSpots() called ===");try{let e=this.cache.get("spots");if(e&&Date.now()-e.timestamp<this.cacheTimeout)return e.data.spots;console.log("=== FETCHING FROM GBFS API ===");let t=await this.fetchFromGBFSAPI();return console.log("GBFS API response:",t.spots.length,"spots found"),this.cache.set("spots",{data:t,timestamp:Date.now()}),console.log("Returning real API data:",t.spots.length,"spots"),t.spots}catch(t){console.error("Hello Cycling API エラー:",t);let e=this.cache.get("spots");if(e)return console.log("キャッシュされたデータを使用します"),e.data.spots;return console.log("API接続失敗、緊急用モックデータを使用"),(await this.getEmergencyMockData()).spots}}async fetchFromGBFSAPI(){try{console.log("=== FETCHING FROM NEXT.JS API ROUTE ==="),console.log("API Route URL: /api/hello-cycling");let e=await fetch("/api/hello-cycling",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok)throw Error("HTTP ".concat(e.status,": ").concat(e.statusText));let t=await e.json();return console.log("API route response received:",t.spots.length,"spots"),t}catch(e){throw console.error("GBFS API エラー:",e),e}}async fetchWithRetry(e){let t=null;for(let a=1;a<=this.maxRetries;a++)try{let t=await fetch(e,{method:"GET",headers:{Accept:"application/json","User-Agent":"SFC-Hello-Cycling-App/1.0","Content-Type":"application/json"},mode:"cors",cache:"no-cache"});if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));return await t.json()}catch(n){t=n,console.warn("API呼び出し失敗 (試行 ".concat(a,"/").concat(this.maxRetries,"):"),{url:e,error:n instanceof Error?n.message:String(n),userAgent:navigator.userAgent}),a<this.maxRetries&&await new Promise(e=>setTimeout(e,this.retryDelay*a))}throw t||Error("API呼び出しに失敗しました")}isInSFCArea(e,t){return e>=this.SFC_AREA_BOUNDS.south&&e<=this.SFC_AREA_BOUNDS.north&&t>=this.SFC_AREA_BOUNDS.west&&t<=this.SFC_AREA_BOUNDS.east}updateHistoricalData(e,t){let a=this.historicalData.get(e)||[];a.push(t);let n=Date.now()/1e3-7200,i=a.filter(e=>e.timestamp>n);this.historicalData.set(e,i)}getHistoricalData(e){return this.historicalData.get(e)||[]}analyzeSpotUtilization(e,t,a){let n=this.getHistoricalData(e),i=a>0?(a-t)/a:0,s=Date.now()/1e3-1800,l=n.filter(e=>e.timestamp>s),o=Date.now()/1e3-600,r=n.filter(e=>e.timestamp>o),c=0,p="stable",d=0,g=!1,u=null,m="low";if(l.length>=2){let e=l[0],t=l[l.length-1],a=t.timestamp-e.timestamp;a>0&&(c=(t.availableBikes-e.availableBikes)/a*60,d=t.timestamp,c>.5?p="increasing":c<-.5&&(p="decreasing"))}if(r.length>=2){let e=r[0],t=r[r.length-1],a=t.timestamp-e.timestamp;if(a>0){let n=(t.availableBikes-e.availableBikes)/a*60;g=Math.abs(n)>1,n<-2?m="extreme":n<-1.5?m="high":n<-1&&(m="medium")}}"decreasing"===p&&c<0&&t>0&&(u=Math.abs(t/c));let h="low";return 0===t?h="critical":t<=2&&i>.8?h="high":t<=5&&i>.6?h="medium":"decreasing"===p&&c<-1&&(h="high"),{utilizationRate:i,urgencyLevel:h,trend:p,changeRate:c,lastChangeTime:d,rapidChange:g,timeToEmpty:u,demandSurge:m}}async getEmergencyMockData(){return console.log("=== USING EMERGENCY MOCK DATA ==="),{spots:[{id:"emergency-1",name:"湘南台駅東口",latitude:35.3964,longitude:139.4669,availableBikes:8,totalBikes:12,isOpen:!0,isRenting:!0,isReturning:!0,lastReported:Math.floor(Date.now()/1e3),address:"神奈川県藤沢市湘南台1-1-1",vehicleCapacity:12,parkingType:"street_parking",isChargingStation:!1,contactPhone:"+8105038218282",rentalUris:{ios:"https://www.hellocycling.jp/app/port/detail/emergency-1",web:"https://www.hellocycling.jp/app/port/detail/emergency-1",android:"https://www.hellocycling.jp/app/port/detail/emergency-1"},utilizationRate:.33,urgencyLevel:"low",trend:"stable",changeRate:0,lastChangeTime:Math.floor(Date.now()/1e3),historicalData:[],rapidChange:!1,timeToEmpty:null,demandSurge:"low"},{id:"emergency-2",name:"SFCキャンパス正門",latitude:35.3889,longitude:139.4272,availableBikes:15,totalBikes:20,isOpen:!0,isRenting:!0,isReturning:!0,lastReported:Math.floor(Date.now()/1e3),address:"神奈川県藤沢市遠藤5322",vehicleCapacity:20,parkingType:"street_parking",isChargingStation:!0,contactPhone:"+8105038218282",rentalUris:{ios:"https://www.hellocycling.jp/app/port/detail/emergency-2",web:"https://www.hellocycling.jp/app/port/detail/emergency-2",android:"https://www.hellocycling.jp/app/port/detail/emergency-2"},utilizationRate:.25,urgencyLevel:"low",trend:"stable",changeRate:0,lastChangeTime:Math.floor(Date.now()/1e3),historicalData:[],rapidChange:!1,timeToEmpty:null,demandSurge:"low"}],lastUpdated:new Date().toISOString()}}async getMockData(){return{spots:[{id:"mock-1",name:"湘南台駅東口",latitude:35.3964,longitude:139.4669,availableBikes:Math.floor(12*Math.random())+1,totalBikes:12,isOpen:!0,isRenting:!0,isReturning:!0,lastReported:Math.floor(Date.now()/1e3),address:"神奈川県藤沢市湘南台1-1-1",vehicleCapacity:12,parkingType:"street_parking",isChargingStation:!1,contactPhone:"+8105038218282",rentalUris:{ios:"https://www.hellocycling.jp/app/port/detail/mock-1?referrer=odpt",web:"https://www.hellocycling.jp/app/port/detail/mock-1?referrer=odpt",android:"https://www.hellocycling.jp/app/port/detail/mock-1?referrer=odpt"},utilizationRate:.3,urgencyLevel:"low",trend:"stable",changeRate:0,lastChangeTime:Math.floor(Date.now()/1e3),historicalData:[],rapidChange:!1,timeToEmpty:null,demandSurge:"low"},{id:"mock-2",name:"湘南台駅西口",latitude:35.396,longitude:139.465,availableBikes:Math.floor(10*Math.random())+1,totalBikes:10,isOpen:!0,isRenting:!0,isReturning:!0,lastReported:Math.floor(Date.now()/1e3),address:"神奈川県藤沢市湘南台1-2-1",vehicleCapacity:10,parkingType:"street_parking",isChargingStation:!1,contactPhone:"+8105038218282",rentalUris:{ios:"https://www.hellocycling.jp/app/port/detail/mock-2?referrer=odpt",web:"https://www.hellocycling.jp/app/port/detail/mock-2?referrer=odpt",android:"https://www.hellocycling.jp/app/port/detail/mock-2?referrer=odpt"},utilizationRate:.6,urgencyLevel:"medium",trend:"decreasing",changeRate:-.5,lastChangeTime:Math.floor(Date.now()/1e3),historicalData:[],rapidChange:!1,timeToEmpty:null,demandSurge:"low"},{id:"mock-3",name:"SFCキャンパス正門",latitude:35.3889,longitude:139.4272,availableBikes:Math.floor(20*Math.random())+1,totalBikes:20,isOpen:!0,isRenting:!0,isReturning:!0,lastReported:Math.floor(Date.now()/1e3),address:"神奈川県藤沢市遠藤5322",vehicleCapacity:20,parkingType:"street_parking",isChargingStation:!0,contactPhone:"+8105038218282",rentalUris:{ios:"https://www.hellocycling.jp/app/port/detail/mock-3?referrer=odpt",web:"https://www.hellocycling.jp/app/port/detail/mock-3?referrer=odpt",android:"https://www.hellocycling.jp/app/port/detail/mock-3?referrer=odpt"},utilizationRate:.8,urgencyLevel:"high",trend:"increasing",changeRate:1.2,lastChangeTime:Math.floor(Date.now()/1e3),historicalData:[],rapidChange:!1,timeToEmpty:null,demandSurge:"low"}],lastUpdated:new Date().toISOString()}}startRealTimeUpdates(e){console.log("=== STARTING REAL-TIME UPDATES ===");let t=setInterval(async()=>{console.log("=== REAL-TIME UPDATE TRIGGERED ===");try{let t=await this.getSpots();console.log("Real-time update: got spots:",t.length),e(t)}catch(e){console.error("リアルタイム更新エラー:",e)}},3e5);return console.log("Getting initial data..."),this.getSpots().then(t=>{console.log("Initial data received:",t.length),e(t)}),()=>{console.log("Cleaning up real-time updates"),clearInterval(t)}}async getSpotDetails(e){try{return(await this.getSpots()).find(t=>t.id===e)||null}catch(e){return console.error("スポット詳細取得エラー:",e),null}}async getAvailableSpots(){try{return(await this.getSpots()).filter(e=>e.availableBikes>0&&e.isOpen)}catch(e){return console.error("利用可能スポット取得エラー:",e),[]}}constructor(){this.stationInfoUrl="https://api-public.odpt.org/api/v4/gbfs/hellocycling/station_information.json",this.stationStatusUrl="https://api-public.odpt.org/api/v4/gbfs/hellocycling/station_status.json",this.cache=new Map,this.cacheTimeout=3e5,this.maxRetries=3,this.retryDelay=1e3,this.historicalData=new Map,this.SFC_AREA_BOUNDS={north:35.4,south:35.35,east:139.5,west:139.4}}}let g=new d;var u=a(2198),m=a(4980),h=a(1990),y=a(76);function f(){let[e,t]=(0,i.useState)([]),[a,s]=(0,i.useState)([]),[l,o]=(0,i.useState)(null),[r,c]=(0,i.useState)(!1),[d,f]=(0,i.useState)(!0),[w,b]=(0,i.useState)(!1),[v,k]=(0,i.useState)(null);(0,i.useRef)(null),(0,i.useEffect)(()=>{s([{id:"route1",name:"メインルート",coordinates:[[139.4669,35.3964],[139.4272,35.3889]],color:"#0066cc",description:"最短ルート（約15分）"},{id:"route2",name:"公園経由ルート",coordinates:[[139.4669,35.3964],[139.44,35.39],[139.4272,35.3889]],color:"#00cc66",description:"公園経由（約20分）"}]),console.log("About to start real-time updates...");let e=g.startRealTimeUpdates(e=>{console.log("=== SPOTS UPDATE FROM API ==="),console.log("New spots count:",e.length),console.log("New spots:",e.map(e=>({name:e.name,lat:e.latitude,lng:e.longitude}))),t(e),console.log("=== END SPOTS UPDATE ===")});return console.log("Real-time updates started, cleanup function:",typeof e),e},[]);let x=t=>{if(0===e.length)return null;let a=e[0],n=S(t[0],t[1],e[0].longitude,e[0].latitude);return e.forEach(e=>{let i=S(t[0],t[1],e.longitude,e.latitude);i<n&&(n=i,a=e)}),a},S=(e,t,a,n)=>{let i=(n-t)*Math.PI/180,s=(a-e)*Math.PI/180,l=Math.sin(i/2)*Math.sin(i/2)+Math.cos(t*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371};console.log("=== FILTERED SPOTS CALCULATION ==="),console.log("Total spots:",e.length),console.log("Filter available:",w);let j=w?e.filter(e=>e.availableBikes>0):e;return console.log("Filtered spots count:",j.length),console.log("Filtered spots:",j.map(e=>({name:e.name,lat:e.latitude,lng:e.longitude}))),console.log("=== END FILTERED SPOTS CALCULATION ==="),(0,n.jsxs)("main",{className:"cycling-main",children:[(0,n.jsxs)("header",{className:"cycling-header",children:[(0,n.jsx)("h1",{className:"cycling-title",children:"SFC通学路上の Hello Cyclingスポット可視化"}),(0,n.jsx)("p",{className:"cycling-description",children:"慶應義塾大学SFC一湘南台駅付近のHello Cyclingスポット可視化して、通学路上でのシェアサイクル利用をスムーズに。"})]}),(0,n.jsxs)("div",{className:"cycling-map-container",children:[(0,n.jsx)(p,{spots:j,routes:a,showRoutes:d,filterAvailable:w,onSpotClick:o,selectedSpot:l,currentLocation:v}),(0,n.jsxs)("div",{className:"cycling-floating-buttons",children:[(0,n.jsx)("button",{className:"cycling-btn cycling-btn-location",onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let t=[e.coords.longitude,e.coords.latitude];k(t);let a=x(t);a&&o(a)},e=>{console.error("位置情報の取得に失敗しました:",e),alert("位置情報の取得に失敗しました。GPSを有効にしてください。")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5}):alert("このブラウザは位置情報をサポートしていません。")},"aria-label":"現在地を取得",children:(0,n.jsx)(u.Z,{size:20})}),(0,n.jsx)("button",{className:"cycling-btn cycling-btn-filter ".concat(w?"active":""),onClick:()=>b(!w),"aria-label":"空き台数でフィルター",children:(0,n.jsx)(m.Z,{size:20})}),(0,n.jsx)("button",{className:"cycling-btn cycling-btn-routes ".concat(d?"active":""),onClick:()=>f(!d),"aria-label":"通学ルート表示切り替え",children:(0,n.jsx)(h.Z,{size:20})})]})]}),(0,n.jsxs)("div",{className:"cycling-bottom-sheet ".concat(r?"open":""),children:[(0,n.jsxs)("div",{className:"cycling-bottom-sheet-handle",onClick:()=>c(!r),children:[(0,n.jsx)("div",{className:"cycling-bottom-sheet-handle-bar"}),(0,n.jsx)(y.Z,{size:16,className:"cycling-bottom-sheet-icon"})]}),(0,n.jsxs)("div",{className:"cycling-bottom-sheet-content",children:[(0,n.jsx)("h3",{className:"cycling-bottom-sheet-title",children:"Hello Cyclingスポット"}),(0,n.jsx)("div",{className:"cycling-spots-list",children:j.map(e=>(0,n.jsxs)("div",{className:"cycling-spot-card ".concat((null==l?void 0:l.id)===e.id?"selected":""),onClick:()=>{o(e)},children:[(0,n.jsxs)("div",{className:"cycling-spot-header",children:[(0,n.jsx)("h4",{className:"cycling-spot-name",children:e.name}),(0,n.jsx)("div",{className:"cycling-spot-status ".concat(e.availableBikes>0?"available":"unavailable"),children:e.availableBikes>0?"利用可能":"満車"})]}),(0,n.jsxs)("div",{className:"cycling-spot-details",children:[(0,n.jsxs)("div",{className:"cycling-spot-bikes",children:[(0,n.jsx)("span",{className:"cycling-spot-bikes-available ".concat(1===e.availableBikes?"low-availability":""),children:e.availableBikes}),(0,n.jsx)("span",{className:"cycling-spot-bikes-separator",children:"/"}),(0,n.jsx)("span",{className:"cycling-spot-bikes-total",children:e.totalBikes}),(0,n.jsx)("span",{className:"cycling-spot-bikes-label",children:"台"})]}),(0,n.jsxs)("div",{className:"cycling-spot-status",children:[(0,n.jsx)("span",{className:"cycling-status-badge ".concat(e.isRenting?"available":"unavailable"),children:e.isRenting?"レンタル可能":"レンタル不可"}),(0,n.jsx)("span",{className:"cycling-status-badge ".concat(e.isReturning?"available":"unavailable"),children:e.isReturning?"返却可能":"返却不可"}),e.isChargingStation&&(0,n.jsx)("span",{className:"cycling-status-badge charging",children:"充電可能"}),(0,n.jsx)("span",{className:"cycling-urgency-badge urgency-".concat(e.urgencyLevel),children:"critical"===e.urgencyLevel?"緊急":"high"===e.urgencyLevel?"要注意":"medium"===e.urgencyLevel?"注意":"余裕あり"}),"stable"!==e.trend&&(0,n.jsx)("span",{className:"cycling-trend-badge trend-".concat(e.trend),children:"increasing"===e.trend?"↗ 増加中":"↘ 減少中"}),e.rapidChange&&(0,n.jsx)("span",{className:"cycling-demand-badge demand-".concat(e.demandSurge),children:"extreme"===e.demandSurge?"\uD83D\uDD25 急減中":"high"===e.demandSurge?"⚡ 急減中":"medium"===e.demandSurge?"\uD83D\uDCC9 やや急減":"通常"})]}),(null==l?void 0:l.id)===e.id&&(0,n.jsxs)("div",{className:"cycling-spot-details",children:[(0,n.jsxs)("div",{className:"cycling-spot-address",children:[(0,n.jsx)(u.Z,{size:14}),e.address]}),(0,n.jsxs)("div",{className:"cycling-spot-capacity",children:["最大収容台数: ",e.vehicleCapacity,"台"]}),(0,n.jsxs)("div",{className:"cycling-spot-parking",children:["駐車タイプ: ","street_parking"===e.parkingType?"路上駐車":e.parkingType]}),(0,n.jsxs)("div",{className:"cycling-spot-last-updated",children:["最終更新: ",new Date(1e3*e.lastReported).toLocaleTimeString()]}),e.timeToEmpty&&e.timeToEmpty<60&&(0,n.jsxs)("div",{className:"cycling-spot-prediction",children:["⏰ 約",Math.round(e.timeToEmpty),"分で満車予想"]}),e.rapidChange&&(0,n.jsxs)("div",{className:"cycling-spot-rapid-change",children:["\uD83D\uDEA8 過去10分で急激な変化を検出","extreme"===e.demandSurge&&" - 極めて高い需要","high"===e.demandSurge&&" - 高い需要","medium"===e.demandSurge&&" - やや高い需要"]})]})]})]},e.id))})]})]})]})}a(2547)},2547:function(){}},function(e){e.O(0,[813,415,196,971,117,744],function(){return e(e.s=6162)}),_N_E=e.O()}]);