(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[437],{6162:function(e,t,a){Promise.resolve().then(a.bind(a,8434))},8434:function(e,t,a){"use strict";a.d(t,{default:function(){return v}});var n=a(7437),i=a(2265),s=a(29),r=a.n(s),l=a(2520),o=a.n(l);a(4982);var c=a(257);function p(e){let{spots:t,routes:a,showRoutes:s,onSpotClick:l,selectedSpot:p,currentLocation:d}=e,g=(0,i.useRef)(null),u=(0,i.useRef)(null),h=(0,i.useRef)([]),m=(0,i.useRef)(null),[y,b]=(0,i.useState)(!1),w=c.env.NEXT_PUBLIC_MAPBOX_TOKEN||"pk.eyJ1Ijoia2VudGEtdGFuYWthIiwiYSI6ImNsb2R0Z2Z0ZzAwMWYzZHF0dGJ6dGJ6dGJ6In0.example";console.log("Mapbox token loaded:",w?"YES":"NO"),console.log("Token preview:",w.substring(0,20)+"...");let v=(0,i.useCallback)(e=>{l(e)},[l]);return(0,i.useEffect)(()=>{if(!u.current)return o().accessToken=w,g.current&&(u.current=new(o()).Map({container:g.current,style:"mapbox://styles/mapbox/streets-v12",center:[139.4494885,35.393351],zoom:14,pitch:0,bearing:0,projection:"mercator"}),u.current.on("load",()=>{b(!0),console.log("Map loaded, ready for Hello Cycling markers...")}),u.current.addControl(new(o()).NavigationControl,"top-right")),()=>{u.current&&(u.current.getSource("cycling-spots")&&(u.current.removeLayer("cycling-spots"),u.current.removeSource("cycling-spots")),u.current.remove(),u.current=null)}},[]),(0,i.useEffect)(()=>{if(!u.current||!y)return;let e={type:"FeatureCollection",features:t.map(e=>({type:"Feature",geometry:{type:"Point",coordinates:[e.longitude,e.latitude]},properties:{id:e.id,name:e.name,availableBikes:e.availableBikes,isRenting:e.isRenting,isReturning:e.isReturning,urgencyLevel:e.urgencyLevel,trend:e.trend,isSelected:(null==p?void 0:p.id)===e.id}}))};u.current.getSource("cycling-spots")&&(u.current.removeLayer("cycling-spots"),u.current.removeSource("cycling-spots")),u.current.addSource("cycling-spots",{type:"geojson",data:e}),u.current.addLayer({id:"cycling-spots",type:"circle",source:"cycling-spots",paint:{"circle-radius":["case",["get","isSelected"],12,8],"circle-color":["case",["==",["get","urgencyLevel"],"critical"],"#E91E63",["==",["get","urgencyLevel"],"high"],"#FF5722",["==",["get","urgencyLevel"],"medium"],"#FF9800","#4CAF50"],"circle-stroke-width":["case",["get","isSelected"],3,1],"circle-stroke-color":"#ffffff"}}),u.current.on("click","cycling-spots",e=>{var a;let n=null===(a=e.features)||void 0===a?void 0:a[0];if(n&&n.properties){let a=t.find(e=>e.id===n.properties.id);a&&(new(o()).Popup({maxWidth:"300px",className:"cycling-popup"}).setLngLat(e.lngLat).setHTML('\n              <div class="cycling-popup-content">\n                <div class="cycling-popup-header">\n                  <h3 class="cycling-popup-title">'.concat(a.name,'</h3>\n                  <span class="cycling-popup-urgency urgency-').concat(a.urgencyLevel," ").concat(0===a.availableBikes?"no-availability":"",'">\n                    ').concat(0===a.availableBikes?"空きなし":"critical"===a.urgencyLevel?"緊急":"high"===a.urgencyLevel?"要注意":"medium"===a.urgencyLevel?"注意":"余裕あり",'\n                  </span>\n                </div>\n                <div class="cycling-popup-body">\n                  <div class="cycling-popup-info">\n                    <div class="cycling-popup-item">\n                      <span class="cycling-popup-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                          <circle cx="12" cy="12" r="10"></circle>\n                          <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>\n                          <line x1="9" y1="9" x2="9.01" y2="9"></line>\n                          <line x1="15" y1="9" x2="15.01" y2="9"></line>\n                        </svg>\n                        利用可能\n                      </span>\n                      <span class="cycling-popup-value ').concat(a.availableBikes>1?"available":1===a.availableBikes?"low-availability":"unavailable",'">\n                        ').concat(a.availableBikes,'台\n                      </span>\n                    </div>\n                    <div class="cycling-popup-item">\n                      <span class="cycling-popup-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>\n                          <circle cx="12" cy="10" r="3"></circle>\n                        </svg>\n                        返却可能台数\n                      </span>\n                      <span class="cycling-popup-value">\n                        ').concat(a.totalBikes-a.availableBikes,"台\n                      </span>\n                    </div>\n                    ").concat(a.rapidChange?'\n                    <div class="cycling-popup-item cycling-popup-alert">\n                      <span class="cycling-popup-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>\n                          <line x1="12" y1="9" x2="12" y2="13"></line>\n                          <line x1="12" y1="17" x2="12.01" y2="17"></line>\n                        </svg>\n                        急激な変化\n                      </span>\n                      <span class="cycling-popup-value demand-surge-'.concat(a.demandSurge,'">\n                        ').concat("extreme"===a.demandSurge?"極めて高い需要":"high"===a.demandSurge?"高い需要":"medium"===a.demandSurge?"やや高い需要":"通常","\n                      </span>\n                    </div>\n                    "):"","\n                    ").concat(a.timeToEmpty&&a.timeToEmpty<30?'\n                    <div class="cycling-popup-item cycling-popup-warning">\n                      <span class="cycling-popup-label">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                          <circle cx="12" cy="12" r="10"></circle>\n                          <polyline points="12,6 12,12 16,14"></polyline>\n                        </svg>\n                        予測時間\n                      </span>\n                      <span class="cycling-popup-value time-warning">\n                        約'.concat(Math.round(a.timeToEmpty),"分で空きなし予想\n                      </span>\n                    </div>\n                    "):"",'\n                    <div class="cycling-popup-reservation">\n                      <button class="cycling-popup-reservation-btn" onclick="window.open(\'').concat(a.reservationUrl||"https://www.hellocycling.jp/",'\', \'_blank\')">\n                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                          <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>\n                          <line x1="8" y1="21" x2="16" y2="21"></line>\n                          <line x1="12" y1="17" x2="12" y2="21"></line>\n                        </svg>\n                        Hello Cyclingで予約\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ')).addTo(u.current),v(a))}}),u.current.on("mouseenter","cycling-spots",()=>{u.current.getCanvas().style.cursor="pointer"}),u.current.on("mouseleave","cycling-spots",()=>{u.current.getCanvas().style.cursor=""})},[t,y,p,v]),(0,i.useEffect)(()=>{if(!u.current||!y||!d)return;let e=document.querySelector(".cycling-current-location-marker");e&&e.remove();let t=document.createElement("div");t.className="cycling-current-location-marker",t.innerHTML='\n      <div class="cycling-current-location-pulse"></div>\n      <div class="cycling-current-location-dot">\uD83D\uDCCD</div>\n    ',new(o()).Marker({element:t,anchor:"center"}).setLngLat([d[0],d[1]]).addTo(u.current)},[d,y]),(0,i.useEffect)(()=>{u.current&&y&&(h.current.forEach(e=>{let t=e.replace("route-","route-layer-");u.current.getLayer(t)&&u.current.removeLayer(t),u.current.getSource(e)&&u.current.removeSource(e)}),h.current=[],s&&a.forEach((e,t)=>{let a="route-".concat(e.id);u.current.getSource(a)&&(u.current.removeLayer("route-layer-".concat(e.id)),u.current.removeSource(a)),u.current.addSource(a,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e.coordinates}}});let n="route-layer-".concat(e.id);u.current.addLayer({id:n,type:"line",source:a,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":e.color,"line-width":4,"line-opacity":.8}}),h.current.push(a)}))},[a,s,y]),(0,i.useEffect)(()=>{if(u.current&&y&&(m.current&&(m.current.remove(),m.current=null),d)){console.log("Adding current location marker:",d);let e=document.createElement("div");e.className="current-location-marker",e.innerHTML='\n        <div class="current-location-pulse"></div>\n        <div class="current-location-dot"></div>\n      ',m.current=new(o()).Marker({element:e,anchor:"center"}).setLngLat(d).addTo(u.current),u.current.flyTo({center:d,zoom:16,duration:2e3,essential:!0})}},[d,y]),(0,n.jsxs)("div",{className:"jsx-30cb74559974ee1e cycling-map-container",children:[(0,n.jsx)("div",{ref:g,className:"jsx-30cb74559974ee1e cycling-map"}),(0,n.jsx)(r(),{id:"30cb74559974ee1e",children:".cycling-marker.jsx-30cb74559974ee1e{position:relative;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-transition:-webkit-transform.2s ease;-moz-transition:-moz-transform.2s ease;-o-transition:-o-transform.2s ease;transition:-webkit-transform.2s ease;transition:-moz-transform.2s ease;transition:-o-transform.2s ease;transition:transform.2s ease}.cycling-marker.jsx-30cb74559974ee1e:hover{-webkit-transform:scale(1.1);-moz-transform:scale(1.1);-ms-transform:scale(1.1);-o-transform:scale(1.1);transform:scale(1.1)}.cycling-marker.selected.jsx-30cb74559974ee1e{-webkit-transform:scale(1.2);-moz-transform:scale(1.2);-ms-transform:scale(1.2);-o-transform:scale(1.2);transform:scale(1.2);z-index:1000}.cycling-marker-icon.jsx-30cb74559974ee1e{width:40px;height:40px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;font-size:20px;-webkit-box-shadow:0 2px 8px rgba(0,0,0,.15);-moz-box-shadow:0 2px 8px rgba(0,0,0,.15);box-shadow:0 2px 8px rgba(0,0,0,.15);-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.cycling-marker-icon.available.jsx-30cb74559974ee1e{background:#4caf50;color:white}.cycling-marker-icon.unavailable.jsx-30cb74559974ee1e{background:#f44336;color:white}.cycling-marker-count.jsx-30cb74559974ee1e{position:absolute;top:-8px;right:-8px;background:#06c;color:white;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;width:20px;height:20px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;font-size:12px;font-weight:600;border:2px solid white}.current-location-marker.jsx-30cb74559974ee1e{position:relative;width:20px;height:20px}.current-location-dot.jsx-30cb74559974ee1e{width:20px;height:20px;background-color:#4285F4;border:3px solid white;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-box-shadow:0 2px 6px rgba(0,0,0,.3);-moz-box-shadow:0 2px 6px rgba(0,0,0,.3);box-shadow:0 2px 6px rgba(0,0,0,.3);position:relative;z-index:2}.current-location-pulse.jsx-30cb74559974ee1e{position:absolute;top:50%;left:50%;width:20px;height:20px;background-color:#4285F4;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-animation:location-pulse 2s infinite;-moz-animation:location-pulse 2s infinite;-o-animation:location-pulse 2s infinite;animation:location-pulse 2s infinite;z-index:1}@-webkit-keyframes location-pulse{0%{-webkit-transform:translate(-50%,-50%)scale(1);transform:translate(-50%,-50%)scale(1);opacity:1}100%{-webkit-transform:translate(-50%,-50%)scale(2);transform:translate(-50%,-50%)scale(2);opacity:0}}@-moz-keyframes location-pulse{0%{-moz-transform:translate(-50%,-50%)scale(1);transform:translate(-50%,-50%)scale(1);opacity:1}100%{-moz-transform:translate(-50%,-50%)scale(2);transform:translate(-50%,-50%)scale(2);opacity:0}}@-o-keyframes location-pulse{0%{-o-transform:translate(-50%,-50%)scale(1);transform:translate(-50%,-50%)scale(1);opacity:1}100%{-o-transform:translate(-50%,-50%)scale(2);transform:translate(-50%,-50%)scale(2);opacity:0}}@keyframes location-pulse{0%{-webkit-transform:translate(-50%,-50%)scale(1);-moz-transform:translate(-50%,-50%)scale(1);-o-transform:translate(-50%,-50%)scale(1);transform:translate(-50%,-50%)scale(1);opacity:1}100%{-webkit-transform:translate(-50%,-50%)scale(2);-moz-transform:translate(-50%,-50%)scale(2);-o-transform:translate(-50%,-50%)scale(2);transform:translate(-50%,-50%)scale(2);opacity:0}}"})]})}class d{async getSpots(){console.log("=== getSpots() called ===");try{let e=this.cache.get("spots");if(e&&Date.now()-e.timestamp<this.cacheTimeout)return e.data.spots;console.log("=== FETCHING FROM GBFS API ===");let t=await this.fetchFromGBFSAPI();return console.log("GBFS API response:",t.spots.length,"spots found"),this.cache.set("spots",{data:t,timestamp:Date.now()}),console.log("Returning real API data:",t.spots.length,"spots"),t.spots}catch(t){console.error("Hello Cycling API エラー:",t);let e=this.cache.get("spots");if(e)return console.log("キャッシュされたデータを使用します"),e.data.spots;return console.log("API接続失敗、緊急用モックデータを使用"),(await this.getEmergencyMockData()).spots}}async fetchFromGBFSAPI(){try{console.log("=== FETCHING FROM NEXT.JS API ROUTE ==="),console.log("API Route URL: /api/hello-cycling");let e=await fetch("/api/hello-cycling",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok)throw Error("HTTP ".concat(e.status,": ").concat(e.statusText));let t=await e.json();return console.log("API route response received:",t.spots.length,"spots"),t}catch(e){throw console.error("GBFS API エラー:",e),e}}async fetchWithRetry(e){let t=null;for(let a=1;a<=this.maxRetries;a++)try{let t=await fetch(e,{method:"GET",headers:{Accept:"application/json","User-Agent":"SFC-Hello-Cycling-App/1.0","Content-Type":"application/json"},mode:"cors",cache:"no-cache"});if(!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));return await t.json()}catch(n){t=n,console.warn("API呼び出し失敗 (試行 ".concat(a,"/").concat(this.maxRetries,"):"),{url:e,error:n instanceof Error?n.message:String(n),userAgent:navigator.userAgent}),a<this.maxRetries&&await new Promise(e=>setTimeout(e,this.retryDelay*a))}throw t||Error("API呼び出しに失敗しました")}isInSFCArea(e,t){return e>=this.SFC_AREA_BOUNDS.south&&e<=this.SFC_AREA_BOUNDS.north&&t>=this.SFC_AREA_BOUNDS.west&&t<=this.SFC_AREA_BOUNDS.east}updateHistoricalData(e,t){let a=this.historicalData.get(e)||[];a.push(t);let n=Date.now()/1e3-7200,i=a.filter(e=>e.timestamp>n);this.historicalData.set(e,i)}getHistoricalData(e){return this.historicalData.get(e)||[]}isSpotReservable(e){return e.availableBikes>0&&e.isOpen&&e.isRenting&&!!e.rentalUris&&!!(e.rentalUris.ios||e.rentalUris.android||e.rentalUris.web)}generateReservationUrl(e){if(!e.rentalUris)return"https://www.hellocycling.jp/";let t="undefined"!=typeof navigator?navigator.userAgent:"",a=/iPad|iPhone|iPod/.test(t),n=/Android/.test(t);return a&&e.rentalUris.ios?e.rentalUris.ios:n&&e.rentalUris.android?e.rentalUris.android:e.rentalUris.web?e.rentalUris.web:e.rentalUris.ios||e.rentalUris.android||e.rentalUris.web||"https://www.hellocycling.jp/"}analyzeSpotUtilization(e,t,a){let n=this.getHistoricalData(e),i=a>0?(a-t)/a:0,s=Date.now()/1e3-1800,r=n.filter(e=>e.timestamp>s),l=Date.now()/1e3-600,o=n.filter(e=>e.timestamp>l),c=0,p="stable",d=0,g=!1,u=null,h="low";if(r.length>=2){let e=r[0],t=r[r.length-1],a=t.timestamp-e.timestamp;a>0&&(c=(t.availableBikes-e.availableBikes)/a*60,d=t.timestamp,c>.5?p="increasing":c<-.5&&(p="decreasing"))}if(o.length>=2){let e=o[0],t=o[o.length-1],a=t.timestamp-e.timestamp;if(a>0){let n=(t.availableBikes-e.availableBikes)/a*60;g=Math.abs(n)>1,n<-2?h="extreme":n<-1.5?h="high":n<-1&&(h="medium")}}"decreasing"===p&&c<0&&t>0&&(u=Math.abs(t/c));let m="low";return 0===t?m="critical":t<=2&&i>.8?m="high":t<=5&&i>.6?m="medium":"decreasing"===p&&c<-1&&(m="high"),{utilizationRate:i,urgencyLevel:m,trend:p,changeRate:c,lastChangeTime:d,rapidChange:g,timeToEmpty:u,demandSurge:h}}async getEmergencyMockData(){return console.log("=== USING EMERGENCY MOCK DATA ==="),{spots:[{id:"emergency-1",name:"湘南台駅東口",latitude:35.3964,longitude:139.4669,availableBikes:8,totalBikes:12,isOpen:!0,isRenting:!0,isReturning:!0,lastReported:Math.floor(Date.now()/1e3),address:"神奈川県藤沢市湘南台1-1-1",vehicleCapacity:12,parkingType:"street_parking",isChargingStation:!1,contactPhone:"+8105038218282",rentalUris:{ios:"https://www.hellocycling.jp/app/port/detail/emergency-1",web:"https://www.hellocycling.jp/app/port/detail/emergency-1",android:"https://www.hellocycling.jp/app/port/detail/emergency-1"},utilizationRate:.33,urgencyLevel:"low",trend:"stable",changeRate:0,lastChangeTime:Math.floor(Date.now()/1e3),historicalData:[],rapidChange:!1,timeToEmpty:null,demandSurge:"low",isReservable:!0,reservationUrl:"https://www.hellocycling.jp/app/port/detail/emergency-1"},{id:"emergency-2",name:"SFCキャンパス正門",latitude:35.3889,longitude:139.4272,availableBikes:15,totalBikes:20,isOpen:!0,isRenting:!0,isReturning:!0,lastReported:Math.floor(Date.now()/1e3),address:"神奈川県藤沢市遠藤5322",vehicleCapacity:20,parkingType:"street_parking",isChargingStation:!0,contactPhone:"+8105038218282",rentalUris:{ios:"https://www.hellocycling.jp/app/port/detail/emergency-2",web:"https://www.hellocycling.jp/app/port/detail/emergency-2",android:"https://www.hellocycling.jp/app/port/detail/emergency-2"},utilizationRate:.25,urgencyLevel:"low",trend:"stable",changeRate:0,lastChangeTime:Math.floor(Date.now()/1e3),historicalData:[],rapidChange:!1,timeToEmpty:null,demandSurge:"low",isReservable:!0,reservationUrl:"https://www.hellocycling.jp/app/port/detail/emergency-2"}],lastUpdated:new Date().toISOString()}}async getMockData(){return{spots:[{id:"mock-1",name:"湘南台駅東口",latitude:35.3964,longitude:139.4669,availableBikes:Math.floor(12*Math.random())+1,totalBikes:12,isOpen:!0,isRenting:!0,isReturning:!0,lastReported:Math.floor(Date.now()/1e3),address:"神奈川県藤沢市湘南台1-1-1",vehicleCapacity:12,parkingType:"street_parking",isChargingStation:!1,contactPhone:"+8105038218282",rentalUris:{ios:"https://www.hellocycling.jp/app/port/detail/mock-1?referrer=odpt",web:"https://www.hellocycling.jp/app/port/detail/mock-1?referrer=odpt",android:"https://www.hellocycling.jp/app/port/detail/mock-1?referrer=odpt"},utilizationRate:.3,urgencyLevel:"low",trend:"stable",changeRate:0,lastChangeTime:Math.floor(Date.now()/1e3),historicalData:[],rapidChange:!1,timeToEmpty:null,demandSurge:"low",isReservable:!0,reservationUrl:"https://www.hellocycling.jp/app/port/detail/mock-1?referrer=odpt"},{id:"mock-2",name:"湘南台駅西口",latitude:35.396,longitude:139.465,availableBikes:Math.floor(10*Math.random())+1,totalBikes:10,isOpen:!0,isRenting:!0,isReturning:!0,lastReported:Math.floor(Date.now()/1e3),address:"神奈川県藤沢市湘南台1-2-1",vehicleCapacity:10,parkingType:"street_parking",isChargingStation:!1,contactPhone:"+8105038218282",rentalUris:{ios:"https://www.hellocycling.jp/app/port/detail/mock-2?referrer=odpt",web:"https://www.hellocycling.jp/app/port/detail/mock-2?referrer=odpt",android:"https://www.hellocycling.jp/app/port/detail/mock-2?referrer=odpt"},utilizationRate:.6,urgencyLevel:"medium",trend:"decreasing",changeRate:-.5,lastChangeTime:Math.floor(Date.now()/1e3),historicalData:[],rapidChange:!1,timeToEmpty:null,demandSurge:"low",isReservable:!0,reservationUrl:"https://www.hellocycling.jp/app/port/detail/mock-2?referrer=odpt"},{id:"mock-3",name:"SFCキャンパス正門",latitude:35.3889,longitude:139.4272,availableBikes:Math.floor(20*Math.random())+1,totalBikes:20,isOpen:!0,isRenting:!0,isReturning:!0,lastReported:Math.floor(Date.now()/1e3),address:"神奈川県藤沢市遠藤5322",vehicleCapacity:20,parkingType:"street_parking",isChargingStation:!0,contactPhone:"+8105038218282",rentalUris:{ios:"https://www.hellocycling.jp/app/port/detail/mock-3?referrer=odpt",web:"https://www.hellocycling.jp/app/port/detail/mock-3?referrer=odpt",android:"https://www.hellocycling.jp/app/port/detail/mock-3?referrer=odpt"},utilizationRate:.8,urgencyLevel:"high",trend:"increasing",changeRate:1.2,lastChangeTime:Math.floor(Date.now()/1e3),historicalData:[],rapidChange:!1,timeToEmpty:null,demandSurge:"low",isReservable:!0,reservationUrl:"https://www.hellocycling.jp/app/port/detail/mock-3?referrer=odpt"}],lastUpdated:new Date().toISOString()}}startRealTimeUpdates(e){console.log("=== STARTING REAL-TIME UPDATES ===");let t=setInterval(async()=>{console.log("=== REAL-TIME UPDATE TRIGGERED ===");try{let t=await this.getSpots();console.log("Real-time update: got spots:",t.length),e(t)}catch(e){console.error("リアルタイム更新エラー:",e)}},3e5);return console.log("Getting initial data..."),this.getSpots().then(t=>{console.log("Initial data received:",t.length),e(t)}),()=>{console.log("Cleaning up real-time updates"),clearInterval(t)}}async getSpotDetails(e){try{return(await this.getSpots()).find(t=>t.id===e)||null}catch(e){return console.error("スポット詳細取得エラー:",e),null}}async getAvailableSpots(){try{return(await this.getSpots()).filter(e=>e.availableBikes>0&&e.isOpen)}catch(e){return console.error("利用可能スポット取得エラー:",e),[]}}constructor(){this.stationInfoUrl="https://api-public.odpt.org/api/v4/gbfs/hellocycling/station_information.json",this.stationStatusUrl="https://api-public.odpt.org/api/v4/gbfs/hellocycling/station_status.json",this.cache=new Map,this.cacheTimeout=3e5,this.maxRetries=3,this.retryDelay=1e3,this.historicalData=new Map,this.SFC_AREA_BOUNDS={north:35.4,south:35.35,east:139.5,west:139.4}}}let g=new d;var u=a(2198),h=a(4980),m=a(1990),y=a(76),b=a(3779),w=a(5212);function v(){let[e,t]=(0,i.useState)([]),[a,s]=(0,i.useState)([]),[r,l]=(0,i.useState)(null),[o,c]=(0,i.useState)(!1),[d,v]=(0,i.useState)(!0),[f,k]=(0,i.useState)(!1),[x,j]=(0,i.useState)(null),[S,C]=(0,i.useState)(!1);(0,i.useRef)(null),(0,i.useEffect)(()=>{s([{id:"route1",name:"メインルート",coordinates:[[139.4669,35.3964],[139.4272,35.3889]],color:"#0066cc",description:"最短ルート（約15分）"},{id:"route2",name:"公園経由ルート",coordinates:[[139.4669,35.3964],[139.44,35.39],[139.4272,35.3889]],color:"#00cc66",description:"公園経由（約20分）"}]),console.log("About to start real-time updates...");let e=g.startRealTimeUpdates(e=>{console.log("=== SPOTS UPDATE FROM API ==="),console.log("New spots count:",e.length),console.log("New spots:",e.map(e=>({name:e.name,lat:e.latitude,lng:e.longitude}))),t(e),console.log("=== END SPOTS UPDATE ===")});return console.log("Real-time updates started, cleanup function:",typeof e),e},[]);let R=t=>{if(0===e.length)return null;let a=e[0],n=N(t[0],t[1],e[0].longitude,e[0].latitude);return e.forEach(e=>{let i=N(t[0],t[1],e.longitude,e.latitude);i<n&&(n=i,a=e)}),a},N=(e,t,a,n)=>{let i=(n-t)*Math.PI/180,s=(a-e)*Math.PI/180,r=Math.sin(i/2)*Math.sin(i/2)+Math.cos(t*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371},T=e=>{if(!e.isReservable){alert("このスポットは現在予約できません。\n\n理由:\n• 自転車が利用できない\n• スポットが閉鎖中\n• レンタルサービスが停止中");return}let t=navigator.userAgent,a=/iPad|iPhone|iPod/.test(t),n=/Android/.test(t),i=e.reservationUrl||"https://www.hellocycling.jp/";if(a||n){var s,r;let t=a?null===(s=e.rentalUris)||void 0===s?void 0:s.ios:null===(r=e.rentalUris)||void 0===r?void 0:r.android;if(t){let e=window.open(t,"_blank");setTimeout(()=>{(!e||e.closed)&&window.open(i,"_blank")},1e3)}else window.open(i,"_blank")}else window.open(i,"_blank");console.log("Reservation opened for spot:",e.name,"URL:",i)};console.log("=== FILTERED SPOTS CALCULATION ==="),console.log("Total spots:",e.length),console.log("Filter available:",f);let E=f?e.filter(e=>e.availableBikes>0):e;return console.log("Filtered spots count:",E.length),console.log("Filtered spots:",E.map(e=>({name:e.name,lat:e.latitude,lng:e.longitude}))),console.log("=== END FILTERED SPOTS CALCULATION ==="),(0,n.jsxs)("main",{className:"cycling-main",children:[(0,n.jsxs)("header",{className:"cycling-header",children:[(0,n.jsx)("h1",{className:"cycling-title",children:"SFC通学路上の Hello Cyclingスポット可視化"}),(0,n.jsx)("p",{className:"cycling-description",children:"慶應義塾大学SFC一湘南台駅付近のHello Cyclingスポット可視化して、通学路上でのシェアサイクル利用をスムーズに。"})]}),(0,n.jsxs)("div",{className:"cycling-map-container",children:[(0,n.jsx)(p,{spots:E,routes:a,showRoutes:d,onSpotClick:l,selectedSpot:r,currentLocation:x}),(0,n.jsxs)("div",{className:"cycling-floating-buttons",children:[(0,n.jsx)("button",{className:"cycling-btn cycling-btn-location ".concat(S?"loading":""),onClick:()=>{if(!navigator.geolocation){alert("このブラウザは位置情報をサポートしていません。");return}confirm("現在地を取得します。\n\n• 位置情報の使用を許可してください\n• GPSが有効になっていることを確認してください\n• 位置情報は地図上でのみ使用され、保存されません\n\n続行しますか？")&&(C(!0),console.log("位置情報を取得中..."),navigator.geolocation.getCurrentPosition(e=>{console.log("位置情報取得成功:",e.coords);let t=[e.coords.longitude,e.coords.latitude];j(t);let a=R(t);a&&(l(a),console.log("最も近いスポットを選択:",a.name)),C(!1),alert("現在地を取得しました！\nマップを現在地に移動します。")},e=>{console.error("位置情報の取得に失敗しました:",e),C(!1);let t="位置情報の取得に失敗しました。\n\n";switch(e.code){case e.PERMISSION_DENIED:t+="位置情報の使用が拒否されました。\nブラウザの設定で位置情報を許可してください。";break;case e.POSITION_UNAVAILABLE:t+="位置情報が利用できません。\nGPSが有効になっているか確認してください。";break;case e.TIMEOUT:t+="位置情報の取得がタイムアウトしました。\nもう一度お試しください。";break;default:t+="不明なエラーが発生しました。"}alert(t)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5}))},disabled:S,"aria-label":S?"位置情報取得中...":"現在地を取得",children:S?(0,n.jsx)("div",{className:"loading-spinner"}):(0,n.jsx)(u.Z,{size:20})}),(0,n.jsx)("button",{className:"cycling-btn cycling-btn-filter ".concat(f?"active":""),onClick:()=>k(!f),"aria-label":"空き台数でフィルター",children:(0,n.jsx)(h.Z,{size:20})}),(0,n.jsx)("button",{className:"cycling-btn cycling-btn-routes ".concat(d?"active":""),onClick:()=>v(!d),"aria-label":"通学ルート表示切り替え",children:(0,n.jsx)(m.Z,{size:20})})]})]}),(0,n.jsxs)("div",{className:"cycling-bottom-sheet ".concat(o?"open":""),children:[(0,n.jsxs)("div",{className:"cycling-bottom-sheet-handle",onClick:()=>c(!o),children:[(0,n.jsx)("div",{className:"cycling-bottom-sheet-handle-bar"}),(0,n.jsx)(y.Z,{size:16,className:"cycling-bottom-sheet-icon"})]}),(0,n.jsxs)("div",{className:"cycling-bottom-sheet-content",children:[(0,n.jsx)("h3",{className:"cycling-bottom-sheet-title",children:"Hello Cyclingスポット"}),(0,n.jsx)("div",{className:"cycling-spots-list",children:E.map(e=>(0,n.jsxs)("div",{className:"cycling-spot-card ".concat((null==r?void 0:r.id)===e.id?"selected":""),onClick:()=>{l(e)},children:[(0,n.jsxs)("div",{className:"cycling-spot-header",children:[(0,n.jsx)("h4",{className:"cycling-spot-name",children:e.name}),(0,n.jsx)("div",{className:"cycling-spot-status ".concat(e.availableBikes>0?"available":"unavailable"),children:e.availableBikes>0?"利用可能":"空きなし"})]}),(0,n.jsxs)("div",{className:"cycling-spot-details",children:[(0,n.jsxs)("div",{className:"cycling-spot-bikes",children:[(0,n.jsx)("span",{className:"cycling-spot-bikes-available ".concat(1===e.availableBikes?"low-availability":""),children:e.availableBikes}),(0,n.jsx)("span",{className:"cycling-spot-bikes-separator",children:"/"}),(0,n.jsx)("span",{className:"cycling-spot-bikes-total",children:e.totalBikes}),(0,n.jsx)("span",{className:"cycling-spot-bikes-label",children:"台"})]}),(0,n.jsxs)("div",{className:"cycling-spot-status",children:[(0,n.jsx)("span",{className:"cycling-status-badge ".concat(e.isRenting?"available":"unavailable"),children:e.isRenting?"レンタル可能":"レンタル不可"}),(0,n.jsx)("span",{className:"cycling-status-badge ".concat(e.isReturning?"available":"unavailable"),children:e.isReturning?"返却可能":"返却不可"}),e.isChargingStation&&(0,n.jsx)("span",{className:"cycling-status-badge charging",children:"充電可能"}),(0,n.jsx)("span",{className:"cycling-urgency-badge urgency-".concat(e.urgencyLevel," ").concat(0===e.availableBikes?"no-availability":""),children:0===e.availableBikes?"空きなし":"critical"===e.urgencyLevel?"緊急":"high"===e.urgencyLevel?"要注意":"medium"===e.urgencyLevel?"注意":"余裕あり"}),"stable"!==e.trend&&(0,n.jsx)("span",{className:"cycling-trend-badge trend-".concat(e.trend),children:"increasing"===e.trend?"↗ 増加中":"↘ 減少中"}),e.rapidChange&&(0,n.jsx)("span",{className:"cycling-demand-badge demand-".concat(e.demandSurge),children:"extreme"===e.demandSurge?"\uD83D\uDD25 急減中":"high"===e.demandSurge?"⚡ 急減中":"medium"===e.demandSurge?"\uD83D\uDCC9 やや急減":"通常"})]}),(null==r?void 0:r.id)===e.id&&(0,n.jsxs)("div",{className:"cycling-spot-details",children:[(0,n.jsxs)("div",{className:"cycling-spot-address",children:[(0,n.jsx)(u.Z,{size:14}),e.address]}),(0,n.jsxs)("div",{className:"cycling-spot-capacity",children:["最大収容台数: ",e.vehicleCapacity,"台"]}),(0,n.jsxs)("div",{className:"cycling-spot-parking",children:["駐車タイプ: ","street_parking"===e.parkingType?"路上駐車":e.parkingType]}),(0,n.jsxs)("div",{className:"cycling-spot-last-updated",children:["最終更新: ",new Date(1e3*e.lastReported).toLocaleTimeString()]}),e.timeToEmpty&&e.timeToEmpty<60&&(0,n.jsxs)("div",{className:"cycling-spot-prediction",children:["⏰ 約",Math.round(e.timeToEmpty),"分で空きなし予想"]}),e.rapidChange&&(0,n.jsxs)("div",{className:"cycling-spot-rapid-change",children:["\uD83D\uDEA8 過去10分で急激な変化を検出","extreme"===e.demandSurge&&" - 極めて高い需要","high"===e.demandSurge&&" - 高い需要","medium"===e.demandSurge&&" - やや高い需要"]}),(0,n.jsx)("div",{className:"cycling-reservation-section",children:e.isReservable?(0,n.jsxs)("button",{className:"cycling-reservation-btn",onClick:()=>T(e),"aria-label":"Hello Cyclingアプリで予約",children:[(0,n.jsx)(b.Z,{size:16}),(0,n.jsx)("span",{children:"Hello Cyclingで予約"}),(0,n.jsx)(w.Z,{size:14})]}):(0,n.jsx)("div",{className:"cycling-reservation-unavailable",children:(0,n.jsx)("span",{children:"現在予約できません"})})})]})]})]},e.id))})]})]})]})}a(2547)},2547:function(){}},function(e){e.O(0,[813,415,195,971,117,744],function(){return e(e.s=6162)}),_N_E=e.O()}]);